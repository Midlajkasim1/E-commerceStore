
   <!-- Owl Carousel CSS -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">

   <%-include("../../views/partials/user/header")%>

 <section id="home-section" class="hero">
    <div class="home-slider owl-carousel">
        <!-- Slide 1 -->
        <div class="slider-item js-fullheight" style="background-image: url('images/gabriel-benois-sVIBH6dMIlI-unsplash.jpg');">
            <div class="overlay"></div>
            <div class="container">
                <div class="row slider-text align-items-center justify-content-center">
                    <div class="col-md-6 text-center">
                        <h1 class="mb-4">Shirt Collection 2019</h1>
                        <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        <p><a href="/shop" class="btn btn-primary">Discover Now</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 2 -->
        <div class="slider-item js-fullheight" style="background-image: url('images/ian-dooley-ufl6sF3VSLI-unsplash.jpg');">
            <div class="overlay"></div>
            <div class="container">
                <div class="row slider-text align-items-center justify-content-center">
                    <div class="col-md-6 text-center">
                        <h1 class="mb-4">New Hoddies Winter Collection</h1>
                        <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        <p><a href="/shop" class="btn btn-primary">Discover Now</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 3 (optional) -->
        <div class="slider-item js-fullheight" style="background-image: url('images/greg-raines-rqFBIR6vQXg-unsplash.jpg');">
            <div class="overlay"></div>
            <div class="container">
                <div class="row slider-text align-items-center justify-content-center">
                    <div class="col-md-6 text-center">
                        <h1 class="mb-4">Summer Pant Collection</h1>
                        <p>Enjoy the sun and the sea with our new summer collection.</p>
                        <p><a href="/shop" class="btn btn-primary">Explore Now</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Services Section -->
    <section class="ftco-section ftco-services">
        <div class="container">
            <div class="row">
                <!-- Service Item -->
                <div class="col-md-4 text-center">
                    <div class="service-box">
                        <div class="icon mb-4">
                            <span class="fas fa-shipping-fast"></span>
                        </div>
                        <h3>Free Shipping</h3>
                        <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia.</p>
                    </div>
                </div>

                <!-- Service Item -->
                <div class="col-md-4 text-center">
                    <div class="service-box">
                        <div class="icon mb-4">
                            <span class="fas fa-headset"></span>
                        </div>
                        <h3>Customer Support</h3>
                        <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia.</p>
                    </div>
                </div>

                <!-- Service Item -->
                <div class="col-md-4 text-center">
                    <div class="service-box">
                        <div class="icon mb-4">
                            <span class="fas fa-lock"></span>
                        </div>
                        <h3>Secure Payments</h3>
                        <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Product Section -->
    <section class="ftco-section bg-light">
        <div class="container">
            <div class="row justify-content-center mb-3 pb-3">
                <div class="col-md-12 heading-section text-center">
                    <h2>New Arrival</h2>
                    <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia.</p>
                </div>
            </div>
            <div class="row g-4">
                <% for(let product of products) { %>
                    <div class="col-md-3">
                        <div class="product-card">
                            <span class="wishlist-btn" onclick="addToWishlist('<%=product._id%>')">❤️</span>
                            <a href="/productDetails?id=<%=product._id%>">
                                <img src="/uploads/re-image/<%= product.productImage[0] %>" 
                                     alt="<%= product.productName %>" 
                                     class="img-fluid rounded">
                            </a>
                            <h5 class="mt-3"><%= product.productName %></h5>
                            <p class="text-muted">
                                <strike>₹<%= product.regularPrice.toLocaleString('en-IN') %></strike>
                            </p>
                            <p>₹<%= product.salePrice.toLocaleString('en-IN') %></p>
                            <button class="add-to-cart-btn w-100" 
                                    onclick="addToCartWithConfirm('<%=product._id%>')">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </section><!-- End section -->
    
<!-- grid product -->
<section class="ftco-section ftco-choose ftco-no-pb ftco-no-pt">
    <div class="container">
        <div class="row no-gutters">
            <!-- First Image Section (Men's Shoes) -->
            <div class="col-lg-4">
                <div class="choose-wrap divider-one img p-5 d-flex flex-column justify-content-center align-items-center" style="background-image: url(images/choose-1.jpg); background-size: cover; background-position: center; height: 100%; min-height: 400px;">
                    <div class="text text-center text-white px-2">
                        <span class="subheading">Men's Shoes</span>
                        <h2>Men's Collection</h2>
                        <p>Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
                        <p><a href="/shop" class="btn btn-custom px-4 py-3">Shop now</a></p>
                    </div>
                </div>
            </div>

            <!-- Second Image Section (Women's Shoes) -->
            <div class="col-lg-8">
                <div class="row no-gutters choose-wrap divider-two align-items-stretch">
                    <div class="col-md-12">
                        <div class="choose-wrap full-wrap img align-self-stretch d-flex flex-column justify-content-center text-center" style="background-image: url(images/Background_\(1\)-transformed.png); background-size: cover; background-position: center; height: 100%; min-height: 400px;">
                            <div class="col-md-7 d-flex flex-column justify-content-center align-items-center">
                                <div class="text text-white px-5">
                                    <span class="subheading">Mens Tshirts</span>
                                    <h2>T-shirts's Collection</h2>
                                    <p>Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
                                    <p><a href="/shop" class="btn btn-custom px-4 py-3">Shop now</a></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Third and Fourth Image Sections (Summer Sale and Best Sellers) -->
                    <div class="col-md-12">
                        <div class="row no-gutters">
                            <!-- Third Image (Summer Sale) -->
                            <div class="col-md-6">
                                <div class="choose-wrap wrap img align-self-stretch bg-light d-flex flex-column justify-content-center text-center" style="background-image: url(images/images\ \(8\).jpg); background-size: cover; background-position: center; height: 100%; min-height: 400px;">
                                    <div class="text text-center text-white px-5">
                                        <span class="subheading">Summer Sale</span>
                                        <h2>Extra 50% Off</h2>
                                        <p>Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
                                        <p><a href="/shop" class="btn btn-custom px-4 py-3">Shop now</a></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Fourth Image (Best Sellers) -->
                            <div class="col-md-6">
                                <div class="choose-wrap wrap img align-self-stretch d-flex flex-column justify-content-center text-center" style="background-image: url(images/choose-3.jpg); background-size: cover; background-position: center; height: 100%; min-height: 400px;">
                                    <div class="text text-center text-white px-5">
                                        <span class="subheading">Shoes</span>
                                        <h2>Best Sellers</h2>
                                        <p>Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
                                        <p><a href="/shop" class="btn btn-custom px-4 py-3">Shop now</a></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


  

 
   <%-include("../../views/partials/user/footer")%>
   <!-- jQuery -->

   <!-- Owl Carousel JS -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

   <script>
    const isUserLoggedIn = <%= locals.user ? 'true' : 'false' %>;

function addToWishlist(productId) {
    if (!isUserLoggedIn) {
        Swal.fire({
            title: 'Login Required',
            text: 'Please login to add to wishlist',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Login',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/login'; 
            }
        });
        return;
    }

    fetch('/addToWishlist', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ productId: productId })
    })
    .then(response => response.json())
    .then(response => {
        if (response.status) {
            Swal.fire({
                title: 'Success!',
                text: 'Product added to wishlist',
                icon: 'success',
                timer: 2000
            });
            // Update wishlist button appearance
            const wishlistBtn = document.querySelector(`[data-product-id="${productId}"]`);
            if (wishlistBtn) {
                wishlistBtn.classList.add('in-wishlist');
            }
        } else {
            Swal.fire({
                title: 'Info',
                text: response.message,
                icon: 'info',
                timer: 2000
            });
        }
    })
    .catch(error => {
        console.error('Error:', error);
        Swal.fire({
            title: 'Error',
            text: 'Failed to add product to wishlist',
            icon: 'error',
            timer: 2000
        });
    });
}
 //add to cart
 function addToCartWithConfirm(productId) {
    if (!isUserLoggedIn) {
        Swal.fire({
            title: 'Login Required',
            text: 'Please login to add to cart',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Login',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/login'; 
            }
        });
        return;
    }
  Swal.fire({
    title: 'Select Size',
    html: `
      <select id="sizeSelect" class="form-select mb-3">
        <option value="">-- Select Size --</option>
        <option value="S">Small (S)</option>
        <option value="M">Medium (M)</option>
        <option value="L">Large (L)</option>
        <option value="XL">X-Large (XL)</option>
      </select>
    `,
    showCancelButton: true,
    confirmButtonColor: '#088178',
    cancelButtonColor: '#6c757d',
    confirmButtonText: 'Add to Cart',
    cancelButtonText: 'Cancel',
    preConfirm: () => {
      const selectedSize = document.getElementById('sizeSelect').value;
      if (!selectedSize) {
        Swal.showValidationMessage('Please select a size');
        return false;
      }
      return selectedSize;
    }
  }).then((result) => {
    if (result.isConfirmed) {
      const selectedSize = result.value;
      
      $.ajax({
        url: `/addToCart/${productId}`,
        method: 'POST',
        data: {
          size: selectedSize,
          quantity: 1
        },
        success: function(response) {
          if (response.outOfStock) {
            Swal.fire({
              title: 'Out of Stock!',
              text: 'Sorry, this product is currently out of stock in the selected size.',
              icon: 'error',
              confirmButtonColor: '#088178'
            });
          } else if (response.alreadyInCart) {
            Swal.fire({
              title: 'Already in Cart!',
              text: 'This product is already in your cart.',
              icon: 'info',
              confirmButtonColor: '#088178',
              confirmButtonText: 'View Cart',
              showCancelButton: true,
              cancelButtonText: 'Continue Shopping'
            }).then((result) => {
              if (result.isConfirmed) {
                window.location.href = '/cart';
              }
            });
          } else if (response.success) {
            Swal.fire({
              title: 'Added!',
              text: 'The product has been added to your cart.',
              icon: 'success',
              confirmButtonColor: '#088178',
              showDenyButton: true,
              denyButtonText: 'View Cart',
              denyButtonColor: '#2c3e50'
            }).then((result) => {
              if (result.isDenied) {
                window.location.href = '/cart';
              }
            });
          } else {
            Swal.fire({
              title: 'Error!',
              text: response.message || 'Failed to add the product to your cart.',
              icon: 'error',
              confirmButtonColor: '#088178'
            });
          }
        },
        error: function() {
          Swal.fire({
            title: 'Error!',
            text: 'Something went wrong. Please try again later.',
            icon: 'error',
            confirmButtonColor: '#088178'
          });
        }
      });
    }
  });
}
</script>